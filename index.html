<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Fishing Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
html,body{margin:0;overflow:hidden;background:#000;touch-action:none}
#money{position:fixed;bottom:10px;right:10px;color:#fff;background:rgba(0,0,0,.6);padding:6px;border-radius:6px}
#msg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-size:22px;display:none}
#inventory{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.slot{width:44px;height:44px;border:2px solid white;color:white;font-size:9px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.slot.active{border-color:yellow}
#joystick{position:fixed;bottom:100px;left:20px;width:100px;height:100px;border-radius:50%;background:rgba(255,255,255,.15)}
#stick{position:absolute;left:30px;top:30px;width:40px;height:40px;border-radius:50%;background:white}
</style>
</head>
<body>

<div id="money">$0</div>
<div id="msg"></div>
<div id="joystick"><div id="stick"></div></div>
<div id="inventory"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ===== THREE ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
const renderer=new THREE.WebGLRenderer();
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.8));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
scene.add(sun);

/* WORLD */
const water=new THREE.Mesh(new THREE.BoxGeometry(300,.5,300),new THREE.MeshLambertMaterial({color:0x1e90ff}));
water.position.y=.25;scene.add(water);

const island=new THREE.Mesh(new THREE.CylinderGeometry(20,26,2,32),new THREE.MeshLambertMaterial({color:0x2e8b57}));
island.position.y=1;scene.add(island);

const sand=new THREE.Mesh(new THREE.CylinderGeometry(24,28,.6,32),new THREE.MeshLambertMaterial({color:0xd2b48c}));
sand.position.y=.8;scene.add(sand);

/* PLAYER */
const player=new THREE.Object3D();
player.position.set(0,3,0);
player.add(camera);
scene.add(player);

/* INVENTORY */
const inventory=["Rod","","","","","","","",""];
let selected=0;
const prices={Clownfish:5,Tuna:10,Shark:25};
let money=0;

const inv=document.getElementById("inventory");
function renderInv(){
 inv.innerHTML="";
 inventory.forEach((it,i)=>{
  const d=document.createElement("div");
  d.className="slot"+(i===selected?" active":"");
  d.textContent=it;
  d.onclick=()=>{selected=i;renderInv();};
  inv.appendChild(d);
 });
}
renderInv();

/* MOVEMENT */
let joy=false,dx=0,dy=0;
const joyDiv=document.getElementById("joystick");
const stick=document.getElementById("stick");
joyDiv.ontouchstart=e=>{
 joy=true;
};
window.ontouchmove=e=>{
 if(!joy)return;
 dx=(e.touches[0].clientX-(joyDiv.offsetLeft+50))/50;
 dy=(e.touches[0].clientY-(joyDiv.offsetTop+50))/50;
 dx=Math.max(-1,Math.min(1,dx));
 dy=Math.max(-1,Math.min(1,dy));
 stick.style.left=30+dx*30+"px";
 stick.style.top=30+dy*30+"px";
};
window.ontouchend=()=>{
 joy=false;dx=dy=0;
 stick.style.left="30px";stick.style.top="30px";
};

/* CAMERA LOOK */
let look=false,lastX=0,lastY=0,yaw=0,pitch=0;
renderer.domElement.addEventListener("touchstart",e=>{
 if(e.target.closest("#inventory")||e.target.closest("#joystick"))return;
 look=true;
 lastX=e.touches[0].clientX;
 lastY=e.touches[0].clientY;
});
renderer.domElement.addEventListener("touchmove",e=>{
 if(!look)return;
 yaw-=(e.touches[0].clientX-lastX)*.004;
 pitch-=(e.touches[0].clientY-lastY)*.004;
 pitch=Math.max(-1.4,Math.min(1.4,pitch));
 lastX=e.touches[0].clientX;
 lastY=e.touches[0].clientY;
});
window.addEventListener("touchend",()=>look=false);

/* FISHING */
let holding=false,holdTime=0,fishing=false,taps=0;
function canFish(){return player.position.y<2.6;}

renderer.domElement.addEventListener("touchstart",()=>{
 if(inventory[selected]==="Rod" && canFish() && !fishing){
  holding=true;holdTime=0;
 }
});
renderer.domElement.addEventListener("touchend",()=>holding=false);
renderer.domElement.addEventListener("touchstart",()=>{if(fishing)taps++;});

function randomFish(){
 const r=Math.random();
 if(r<.25)return"Clownfish";
 if(r<.5)return"Tuna";
 return"Shark";
}
function addItem(f){
 for(let i=0;i<inventory.length;i++){
  if(inventory[i]===""){inventory[i]=f;renderInv();return;}
 }
}
function startFishing(){
 fishing=true;
 msg.style.display="block";
 msg.textContent="Fishing...";
 setTimeout(()=>{
  const f=randomFish();
  msg.textContent=f+"! TAP!";
  taps=0;
  setTimeout(()=>{
   if(taps>=10){msg.textContent="Caught "+f;addItem(f);}
   else msg.textContent="Escaped!";
   setTimeout(()=>{msg.style.display="none";fishing=false},1500);
  },5000);
 },500);
}

/* LOOP */
function animate(){
 requestAnimationFrame(animate);

 const f=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
 const r=new THREE.Vector3(f.z,0,-f.x);
 player.position.add(f.multiplyScalar(-dy*.12));
 player.position.add(r.multiplyScalar(dx*.12));

 camera.rotation.order="YXZ";
 camera.rotation.y=yaw;
 camera.rotation.x=pitch;

 if(holding&&!fishing){
  holdTime+=.016;
  if(holdTime>=2){startFishing();holding=false;}
 }

 renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
