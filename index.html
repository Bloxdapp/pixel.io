<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Fishing Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:black;touch-action:none}

/* UI */
#money{
Â position:fixed;bottom:10px;right:10px;
Â color:white;font-size:18px;
Â background:rgba(0,0,0,.5);
Â padding:6px 10px;border-radius:6px
}
#book{
Â position:fixed;top:10px;left:10px;
Â font-size:28px;cursor:pointer;
Â z-index:10
}
#rules{
Â position:fixed;top:50%;left:50%;
Â transform:translate(-50%,-50%);
Â width:85%;max-width:420px;
Â background:rgba(0,0,0,.9);
Â color:white;padding:20px;
Â border-radius:12px;
Â display:none;
Â z-index:20
}
#rules button{
Â margin-top:12px;padding:6px 14px;
Â font-size:16px
}
#msg{
Â position:fixed;top:50%;left:50%;
Â transform:translate(-50%,-50%);
Â color:white;font-size:22px;
Â display:none;text-shadow:2px 2px 5px black
}

/* Controls */
#joystick{position:fixed;bottom:120px;left:20px;width:110px;height:110px;background:rgba(255,255,255,.15);border-radius:50%}
#stick{position:absolute;left:30px;top:30px;width:50px;height:50px;background:white;border-radius:50%}
#jump{position:fixed;bottom:120px;right:20px;width:80px;height:80px;border-radius:50%}

/* Inventory */
#inventory{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.slot{width:42px;height:42px;border:2px solid white;color:white;font-size:9px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.slot.active{border-color:yellow}

/* SHOP */
#shop{
Â position:fixed;
Â top:50%;left:50%;
Â transform:translate(-50%,-50%);
Â background:rgba(0,0,0,.9);
Â color:white;
Â padding:20px;
Â border-radius:12px;
Â display:none;
Â z-index:50;
Â text-align:center
}
#shop button{
Â margin:6px;
Â padding:6px 14px;
Â font-size:16px
}

/* LOGIN */
#login{
Â position:fixed;
Â top:50%;left:50%;
Â transform:translate(-50%,-50%);
Â background:rgba(0,0,0,.9);
Â color:white;
Â padding:20px;
Â border-radius:12px;
Â z-index:100;
Â text-align:center;
}
#login input{
Â padding:6px 10px;
Â font-size:16px;
Â margin-bottom:12px;
}
#login button{
Â padding:6px 14px;
Â font-size:16px;
}
</style>
</head>
<body>

<div id="login">
Â <h2>Login</h2>
Â <input type="text" id="username" placeholder="Enter username"><br>
Â <button id="loginBtn">Login</button>
</div>

<div id="book">ğŸ“˜</div>

<div id="rules">
Â <h2>Fishing Game Rules</h2>
Â <p>
Â ğŸ® <b>Controls</b><br>
Â â€¢ Move with left joystick<br>
Â â€¢ Swipe screen to look<br>
Â â€¢ Jump with jump button<br><br>

Â ğŸ£ <b>Fishing</b><br>
Â â€¢ Equip Rod from inventory<br>
Â â€¢ Hold screen 2 seconds to cast<br>
Â â€¢ Wait for fish<br>
Â â€¢ Tap fast to catch it<br><br>

Â ğŸŸ <b>Fish Chances</b><br>
Â â€¢ Clownfish â€“ ~25%<br>
Â â€¢ Tuna â€“ ~25%<br>
Â â€¢ Shark â€“ ~50%<br>
Â â€¢ Pufferfish â€“ 1/3<br>
Â â€¢ Sea Turtle â€“ 1/5<br>
Â â€¢ Manta Ray â€“ 1/25<br>
Â â€¢ Megalodon â€“ 1/50<br><br>

Â ğŸ’° <b>Selling</b><br>
Â â€¢ Tap fish once to preview<br>
Â â€¢ Tap twice to sell
Â </p>
Â <button onclick="rules.style.display='none'">CLOSE</button>
</div>

<div id="money">$0</div>
<div id="msg"></div>

<div id="joystick"><div id="stick"></div></div>
<button id="jump">JUMP</button>
<div id="inventory"></div>

<div id="shop">
Â <h3>Shop</h3>
Â <button id="buySunRod">Buy Sun Rod ($1000)</button><br>
Â <button id="buyBait">Buy 1 Bait ($25)</button><br><br>
Â <button onclick="shop.style.display='none'">CLOSE</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
<script>
/* ===== SCENE SETUP ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB); // Sky Blue Background

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0xffffff,.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
sun.castShadow=true;
scene.add(sun);

/* ğŸŒŠ WATER / BLUE FLOOR */
// Segmented plane for wave animation
const waterGeo=new THREE.PlaneGeometry(200,200,50,50); 
const waterMat=new THREE.MeshStandardMaterial({
Â Â color:0x1e90ff, // Blue color
Â Â roughness:0.3,
Â Â metalness:0.1,
Â Â side:THREE.DoubleSide
});
const water=new THREE.Mesh(waterGeo,waterMat);
water.rotation.x=-Math.PI/2;
water.position.y=0; // The ground level
scene.add(water);

/* ğŸï¸ ISLAND */
const islandGeo=new THREE.CylinderGeometry(18,22,2,64);
const islandMat=new THREE.MeshStandardMaterial({color:0x2e8b57, roughness:0.8, metalness:0.1});
const island=new THREE.Mesh(islandGeo,islandMat);
island.position.set(0,1,0); // Island sits centered above the floor
scene.add(island);

/* ğŸŒ² TREES */
function addTree(x,z){
Â Â // trunk
Â Â const trunkGeo=new THREE.CylinderGeometry(0.3,0.5,3,12);
Â Â const trunkMat=new THREE.MeshStandardMaterial({color:0x8b4513});
Â Â const trunk=new THREE.Mesh(trunkGeo,trunkMat);
Â Â trunk.position.set(x,1.5,z);
Â Â trunk.castShadow=true;
Â Â scene.add(trunk);

Â Â // layered leaves
Â Â for(let i=0;i<3;i++){
Â  Â Â const leavesGeo=new THREE.ConeGeometry(1.5-i*0.3,1.5,8);
Â  Â Â const leavesMat=new THREE.MeshStandardMaterial({color:0x228b22});
Â  Â Â const leaves=new THREE.Mesh(leavesGeo,leavesMat);
Â  Â Â leaves.position.set(x,3+i*0.5,z);
Â  Â Â leaves.castShadow=true;
Â  Â Â scene.add(leaves);
Â Â }
}
for(let i=0;i<6;i++){
Â addTree(Math.random()*12-6,Math.random()*12-6);
}

/* ORB (Shop trigger) */
const orb=new THREE.Mesh(
Â new THREE.SphereGeometry(0.4,16,16),
Â new THREE.MeshStandardMaterial({
Â Â color:0xffff00,
Â Â emissive:0xffff00,
Â Â emissiveIntensity:0.7
Â })
);
orb.position.set(3,3,3);
scene.add(orb);

/* PLAYER */
const player=new THREE.Object3D();
scene.add(player);
player.position.set(0,3,0); // Player starting position
player.add(camera);

let velocityY=0,grounded=true;
let yaw=0,pitch=0;

/* CAMERA LOOK */
let looking=false,lastX=0,lastY=0;
addEventListener("touchstart",e=>{
Â if(e.target.closest(".slot")||e.target.id==="joystick"||e.target.id==="stick"||e.target.id==="jump"||e.target.id==="book")return;
Â looking=true;
Â lastX=e.touches[0].clientX;
Â lastY=e.touches[0].clientY;
});
addEventListener("touchmove",e=>{
Â if(!looking)return;
Â yaw-=(e.touches[0].clientX-lastX)*.004;
Â pitch-=(e.touches[0].clientY-lastY)*.004;
Â pitch=Math.max(-1.4,Math.min(1.4,pitch));
Â lastX=e.touches[0].clientX;
Â lastY=e.touches[0].clientY;
});
addEventListener("touchend",()=>looking=false);

/* MOVE */
let moveX=0,moveZ=0,joy=false,center={};
joystick.addEventListener("touchstart",()=>{
Â joy=true;
Â const r=joystick.getBoundingClientRect();
Â center={x:r.left+r.width/2,y:r.top+r.height/2};
});
addEventListener("touchmove",e=>{
Â if(!joy)return;
Â let dx=e.touches[0].clientX-center.x;
Â let dy=e.touches[0].clientY-center.y;
Â dx=Math.max(-40,Math.min(40,dx));
Â dy=Math.max(-40,Math.min(40,dy));
Â stick.style.left=30+dx+"px";
Â stick.style.top=30+dy+"px";
Â moveX=dx/40;
Â moveZ=dy/40;
});
addEventListener("touchend",()=>{
Â joy=false;
Â stick.style.left="30px";
Â stick.style.top="30px";
Â moveX=moveZ=0;
});

/* JUMP */
jump.addEventListener("touchstart",()=>{
Â if(grounded){velocityY=.18;grounded=false;}
});

/* INVENTORY */
let money=0;
const prices={
Â Â Clownfish:5,
Â Â Tuna:10,
Â Â Shark:25,
Â Â Pufferfish:25,
Â Â SeaTurtle:50,
Â Â MantaRay:500,
Â Â Megalodon:1000
};
const inventory=["Rod","","","","","","","",""];
let selected=0;
const inv=document.getElementById("inventory");
let lastTap=0;
let preview=null;

// Helper: Parse item and count
function parseStack(item){
Â if(!item) return {name:"",count:0};
Â const match = item.match(/^(.+)x(\d+)$/);
Â if(match) return {name:match[1],count:parseInt(match[2])};
Â return {name:item,count:1};
}

function renderInv(){
Â inv.innerHTML="";
Â inventory.forEach((it,i)=>{
Â Â const d=document.createElement("div");
Â Â d.className="slot"+(i===selected?" active":"");
Â Â d.textContent=it;
Â Â d.onclick=()=>slotTap(i);
Â Â inv.appendChild(d);
Â });
}
renderInv();

function slotTap(i){
Â const now=Date.now();
Â const {name,count} = parseStack(inventory[i]);
Â if(name==="Rod" || name==="Sun Rod"){selected=i;removePreview();renderInv();return;}
Â if(!name) return;
Â if(now-lastTap<400){
Â Â money += (prices[name]||0) * count;
Â Â inventory[i]="";
Â Â document.getElementById("money").textContent="$"+money;
Â Â removePreview();
Â Â renderInv();
Â }else{
Â Â previewFish(name);
Â Â lastTap=now;
Â }
}

function previewFish(name){
Â removePreview();
Â const color=name==="Shark"?0x555555:
Â Â  Â  Â  Â  Â  Â Â name==="Tuna"?0xaaaaaa:
Â Â  Â  Â  Â  Â  Â Â name==="Clownfish"?0xff8800:
Â Â  Â  Â  Â  Â  Â Â name==="Pufferfish"?0xffff00:
Â Â  Â  Â  Â  Â  Â Â name==="SeaTurtle"?0x00ffff:
Â Â  Â  Â  Â  Â  Â Â name==="MantaRay"?0x00ffcc:
Â Â  Â  Â  Â  Â  Â Â name==="Megalodon"?0xff0000:
Â Â  Â  Â  Â  Â  Â Â 0xffffff;
Â preview=new THREE.Mesh(
Â Â new THREE.SphereGeometry(.25,16,16),
Â Â new THREE.MeshStandardMaterial({color})
Â );
Â preview.position.set(0,-.2,-1);
Â camera.add(preview);
}
function removePreview(){if(preview){camera.remove(preview);preview=null;}}

/* ROD */
let rod=null;
function updateRod(){
Â if(inventory[selected]==="Rod" || inventory[selected]==="Sun Rod"){
Â Â if(!rod){
Â Â Â rod=new THREE.Mesh(
Â  Â Â new THREE.CylinderGeometry(.02,.02,1),
Â  Â Â new THREE.MeshStandardMaterial({color:inventory[selected]==="Sun Rod"?0xffcc00:0x8b4513})
Â Â Â );
Â Â Â rod.position.set(.3,-.4,-1);
Â Â Â rod.rotation.z=Math.PI/4;
Â Â Â camera.add(rod);
Â Â }else{
Â Â Â rod.material.color.set(inventory[selected]==="Sun Rod"?0xffcc00:0x8b4513);
Â Â }
Â }else if(rod){camera.remove(rod);rod=null;}
}

/* ORB CLICK â†’ SHOP */
const raycaster=new THREE.Raycaster();
const touchVec=new THREE.Vector2();
const shop=document.getElementById("shop");

addEventListener("touchstart",e=>{
Â touchVec.x=(e.touches[0].clientX/innerWidth)*2-1;
Â touchVec.y=-(e.touches[0].clientY/innerHeight)*2+1;
Â raycaster.setFromCamera(touchVec,camera);
Â if(raycaster.intersectObject(orb).length){
Â Â shop.style.display="block";
Â }
});

/* SHOP BUTTONS */
buySunRod.onclick=()=>{
Â if(money<1000)return alert("Not enough money");
Â // Replace Rod with Sun Rod
Â for(let i=0;i<inventory.length;i++){
Â Â if(inventory[i]==="Rod"){inventory[i]="Sun Rod"; renderInv(); money-=1000; document.getElementById("money").textContent="$"+money; return;}
Â }
Â // If no Rod, add Sun Rod to empty slot
Â for(let i=0;i<inventory.length;i++){
Â Â if(inventory[i]===""){inventory[i]="Sun Rod"; money-=1000; document.getElementById("money").textContent="$"+money; renderInv(); return;}
Â }
Â alert("Inventory full!");
};

buyBait.onclick=()=>{
Â if(money<25)return alert("Not enough money");
Â for(let i=0;i<inventory.length;i++){
Â Â if(inventory[i]===""){
Â Â Â inventory[i]="Bait";
Â Â Â money-=25;
Â Â Â document.getElementById("money").textContent="$"+money;
Â Â Â renderInv();
Â Â Â return;
Â Â }
Â }
Â alert("Inventory full!");
};

/* FISHING */
let holding=false,holdTime=0,fishing=false,taps=0;
addEventListener("touchstart",()=>{if(inventory[selected]==="Rod" || inventory[selected]==="Sun Rod"){if(!fishing){holding=true;holdTime=0}}});
addEventListener("touchend",()=>{holding=false;holdTime=0});
addEventListener("touchstart",()=>{if(fishing)taps++});

// Random Fish with probabilities
function randomFish(){
Â const r=Math.random();
Â let fish = "";
Â if(r<1/50) fish = "Megalodon";
Â else if(r<1/25) fish = "MantaRay";
Â else if(r<1/5) fish = "SeaTurtle";
Â else if(r<1/3) fish = "Pufferfish";
Â else if(r<0.58) fish = "Tuna";
Â else if(r<0.83) fish = "Clownfish";
Â else fish = "Shark";

Â // Double chance if Sun Rod equipped
Â if(inventory[selected]==="Sun Rod"){
Â Â Â if(Math.random() < 0.5) return fish; // extra 50% chance
Â }
Â return fish;
}

function addItem(f){
Â for(let i=0;i<inventory.length;i++){
Â Â Â const {name,count} = parseStack(inventory[i]);
Â Â Â if(name===f){
Â Â  Â Â inventory[i] = name+"x"+(count+1);
Â Â  Â Â renderInv();
Â Â  Â Â return;
Â Â Â }
Â }
Â for(let i=0;i<inventory.length;i++){
Â Â Â if(inventory[i]===""){inventory[i]=f;renderInv();return;}
Â }
Â alert("Inventory full!");
}

function startFishing(){
Â fishing=true;
Â msg.style.display="block";
Â msg.textContent="Waiting for fish...";
Â setTimeout(()=>{
Â Â const fish=randomFish();
Â Â msg.textContent=fish+"! TAP!";
Â Â taps=0;
Â Â setTimeout(()=>{
Â Â Â if(taps>=10){msg.textContent="Caught "+fish+"!";addItem(fish);}
Â Â Â else msg.textContent="Fish escaped!";
Â Â Â setTimeout(()=>{msg.style.display="none";fishing=false},2000);
Â Â },5000);
Â },500);
}

/* BOOK */
book.onclick=()=>rules.style.display="block";

/* ===== LOGIN FEATURE ===== */
const loginDiv = document.getElementById("login");
const usernameInput = document.getElementById("username");
const loginBtn = document.getElementById("loginBtn");

let username = null;

function loadPlayerData(name){
Â Â const data = localStorage.getItem("fishingGame_" + name);
Â Â if(data){
Â  Â Â const parsed = JSON.parse(data);
Â  Â Â money = parsed.money || 0;
Â  Â Â inventory.splice(0, inventory.length, ...parsed.inventory || inventory);
Â  Â Â selected = parsed.selected || 0;
Â Â }
Â Â document.getElementById("money").textContent="$"+money;
Â Â renderInv();
}

function savePlayerData(){
Â Â if(!username) return;
Â Â localStorage.setItem("fishingGame_" + username, JSON.stringify({
Â  Â Â money,
Â  Â Â inventory,
Â  Â Â selected
Â Â }));
}

loginBtn.onclick = ()=>{
Â Â const name = usernameInput.value.trim();
Â Â if(!name) return alert("Enter a username");
Â Â username = name;
Â Â loadPlayerData(username);
Â Â loginDiv.style.display = "none";
Â Â savePlayerData();
};

setInterval(savePlayerData, 5000);

/* ===== LOOP ===== */
function animate(){
Â requestAnimationFrame(animate);
Â updateRod();

Â camera.rotation.order="YXZ";
Â camera.rotation.y=yaw;
Â camera.rotation.x=pitch;

Â const f=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
Â const r=new THREE.Vector3(f.z,0,-f.x);
Â player.position.add(f.multiplyScalar(moveZ*.15));
Â player.position.add(r.multiplyScalar(moveX*.15));

Â velocityY-=.01;
Â player.position.y+=velocityY;
Â // Grounding height logic
Â if(player.position.y<=3){player.position.y=3;velocityY=0;grounded=true;}

Â if(holding&&!fishing){
Â Â holdTime+=.016;
Â Â if(holdTime>=2){startFishing();holding=false;}
Â }

Â // ğŸŒŠ Water Animation
Â const positions = water.geometry.attributes.position;
Â for(let i=0;i<positions.count;i++){
Â Â Â // Apply simple sine wave to Y coordinate
Â Â Â positions.setY(i,Math.sin(i/5 + performance.now()*0.002)*0.1);
Â }
Â positions.needsUpdate=true;

Â renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
