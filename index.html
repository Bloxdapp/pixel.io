<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Fishing Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:black;touch-action:none}

/* UI */
#money{position:fixed;top:10px;left:10px;color:white;font-size:18px}
#msg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-size:22px;display:none;text-shadow:2px 2px 5px black}

/* Joystick */
#joystick{position:fixed;bottom:120px;left:20px;width:110px;height:110px;background:rgba(255,255,255,.15);border-radius:50%}
#stick{position:absolute;left:30px;top:30px;width:50px;height:50px;background:white;border-radius:50%}

/* Jump */
#jump{position:fixed;bottom:120px;right:20px;width:80px;height:80px;border-radius:50%}

/* Inventory */
#inventory{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.slot{width:42px;height:42px;border:2px solid white;color:white;font-size:9px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.slot.active{border-color:yellow}
</style>
</head>
<body>

<div id="money">$0</div>
<div id="msg"></div>

<div id="joystick"><div id="stick"></div></div>
<button id="jump">JUMP</button>
<div id="inventory"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ===== SCENE ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
scene.add(sun);

/* WORLD */
const water=new THREE.Mesh(
  new THREE.BoxGeometry(200,.5,200),
  new THREE.MeshLambertMaterial({color:0x1e90ff})
);
water.position.y=.25;
scene.add(water);

const island=new THREE.Mesh(
  new THREE.CylinderGeometry(15,20,2,32),
  new THREE.MeshLambertMaterial({color:0x2e8b57})
);
island.position.set(0,1,0);
scene.add(island);

/* PLAYER */
const player=new THREE.Object3D();
scene.add(player);
player.position.set(0,3,0); // SPAWN ON ISLAND
player.add(camera);

let velocityY=0,grounded=true;
let yaw=0,pitch=0;

/* CAMERA LOOK */
let looking=false,lastX=0,lastY=0;
addEventListener("touchstart",e=>{
 if(e.target.closest(".slot")||e.target.id==="joystick"||e.target.id==="stick"||e.target.id==="jump")return;
 looking=true;
 lastX=e.touches[0].clientX;
 lastY=e.touches[0].clientY;
});
addEventListener("touchmove",e=>{
 if(!looking)return;
 yaw-=(e.touches[0].clientX-lastX)*.004;
 pitch-=(e.touches[0].clientY-lastY)*.004;
 pitch=Math.max(-1.4,Math.min(1.4,pitch));
 lastX=e.touches[0].clientX;
 lastY=e.touches[0].clientY;
});
addEventListener("touchend",()=>looking=false);

/* MOVE */
let moveX=0,moveZ=0,joy=false,center={};
const joystick=document.getElementById("joystick");
const stick=document.getElementById("stick");

joystick.addEventListener("touchstart",()=>{
 joy=true;
 const r=joystick.getBoundingClientRect();
 center={x:r.left+r.width/2,y:r.top+r.height/2};
});
addEventListener("touchmove",e=>{
 if(!joy)return;
 let dx=e.touches[0].clientX-center.x;
 let dy=e.touches[0].clientY-center.y;
 dx=Math.max(-40,Math.min(40,dx));
 dy=Math.max(-40,Math.min(40,dy));
 stick.style.left=30+dx+"px";
 stick.style.top=30+dy+"px";
 moveX=dx/40;
 moveZ=dy/40;
});
addEventListener("touchend",()=>{
 joy=false;
 stick.style.left="30px";
 stick.style.top="30px";
 moveX=moveZ=0;
});

/* JUMP */
jump.addEventListener("touchstart",()=>{
 if(grounded){velocityY=.18;grounded=false;}
});

/* INVENTORY */
let money=0;
const inventory=["Rod","","","","","","","",""];
let selected=0;
const inv=document.getElementById("inventory");

function renderInv(){
 inv.innerHTML="";
 inventory.forEach((it,i)=>{
  const d=document.createElement("div");
  d.className="slot"+(i===selected?" active":"");
  d.textContent=it;
  d.onclick=()=>{
   if(it!=="Rod"&&it!==""){
     sellFish(i);
   }else{
     selected=i;
     renderInv();
   }
  };
  inv.appendChild(d);
 });
}
renderInv();

/* ROD MODEL */
let rod;
function updateRod(){
 if(inventory[selected]==="Rod"){
  if(!rod){
   rod=new THREE.Mesh(
    new THREE.CylinderGeometry(.02,.02,1),
    new THREE.MeshBasicMaterial({color:0x8b4513})
   );
   rod.position.set(.3,-.4,-1);
   rod.rotation.z=Math.PI/4;
   camera.add(rod);
  }
 }else{
  if(rod){camera.remove(rod);rod=null;}
 }
}

/* FISHING */
let holding=false,holdTime=0,fishing=false,taps=0;
const msg=document.getElementById("msg");

addEventListener("touchstart",()=>{
 if(inventory[selected]!=="Rod"||fishing)return;
 holding=true;holdTime=0;
});
addEventListener("touchend",()=>{holding=false;holdTime=0});
addEventListener("touchstart",()=>{if(fishing)taps++});

function randomFish(){
 const r=Math.random();
 if(r<.25)return "Clownfish";
 if(r<.5)return "Tuna";
 return "Shark";
}

function addItem(item){
 for(let i=0;i<inventory.length;i++){
  if(inventory[i]===""){inventory[i]=item;renderInv();return;}
 }
}

function sellFish(i){
 const prices={Clownfish:5,Tuna:10,Shark:25};
 money+=prices[inventory[i]];
 inventory[i]="";
 document.getElementById("money").textContent="$"+money;
 renderInv();
}

function startFishing(){
 fishing=true;
 msg.style.display="block";
 msg.textContent="Waiting for fish...";
 setTimeout(()=>{
  const fish=randomFish();
  msg.textContent=fish+"! TAP!";
  taps=0;
  setTimeout(()=>{
   if(taps>=10){
    msg.textContent="Caught "+fish+"!";
    addItem(fish);
   }else msg.textContent="Fish escaped!";
   setTimeout(()=>{msg.style.display="none";fishing=false},2000);
  },5000);
 },500);
}

/* LOOP */
function animate(){
 requestAnimationFrame(animate);

 updateRod();

 camera.rotation.order="YXZ";
 camera.rotation.y=yaw;
 camera.rotation.x=pitch;

 const f=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
 const r=new THREE.Vector3(f.z,0,-f.x);
 player.position.add(f.multiplyScalar(moveZ*.15));
 player.position.add(r.multiplyScalar(moveX*.15));

 velocityY-=.01;
 player.position.y+=velocityY;
 if(player.position.y<=3){
  player.position.y=3;
  velocityY=0;
  grounded=true;
 }

 if(holding&&!fishing){
  holdTime+=.016;
  if(holdTime>=2){startFishing();holding=false;}
 }

 renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>

