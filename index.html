<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Fishing Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:black;touch-action:none}

/* UI */
#money{
 position:fixed;bottom:10px;right:10px;
 color:white;font-size:18px;
 background:rgba(0,0,0,.5);
 padding:6px 10px;border-radius:6px
}
#book{position:fixed;top:10px;left:10px;font-size:28px;cursor:pointer;z-index:10}
#msg{
 position:fixed;top:50%;left:50%;
 transform:translate(-50%,-50%);
 color:white;font-size:22px;
 display:none;text-shadow:2px 2px 5px black
}

/* SHOP */
#shop{
 position:fixed;top:50%;left:50%;
 transform:translate(-50%,-50%);
 background:rgba(0,0,0,.9);
 color:white;padding:20px;
 border-radius:12px;
 display:none;z-index:30
}
#shop button{display:block;margin:8px auto;padding:8px 16px}

/* Controls */
#joystick{position:fixed;bottom:120px;left:20px;width:110px;height:110px;background:rgba(255,255,255,.15);border-radius:50%}
#stick{position:absolute;left:30px;top:30px;width:50px;height:50px;background:white;border-radius:50%}
#jump{position:fixed;bottom:120px;right:20px;width:80px;height:80px;border-radius:50%}

/* Inventory */
#inventory{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:6px}
.slot{width:42px;height:42px;border:2px solid white;color:white;font-size:9px;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.slot.active{border-color:yellow}
</style>
</head>
<body>

<div id="book">ðŸ“˜</div>
<div id="money">$0</div>
<div id="msg"></div>

<div id="shop">
 <h3>Fisherman</h3>
 <button id="buyRod">Buy Sun Rod ($100)</button>
 <button id="buyBait">Buy Bait ($15)</button>
 <button onclick="shop.style.display='none'">Close</button>
</div>

<div id="joystick"><div id="stick"></div></div>
<button id="jump">JUMP</button>
<div id="inventory"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* SCENE */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(10,20,10);
scene.add(sun);

/* WORLD */
const water=new THREE.Mesh(
 new THREE.BoxGeometry(200,.5,200),
 new THREE.MeshLambertMaterial({color:0x1e90ff})
);
water.position.y=.25;
scene.add(water);

const island=new THREE.Mesh(
 new THREE.CylinderGeometry(18,22,2,32),
 new THREE.MeshLambertMaterial({color:0x2e8b57})
);
island.position.set(0,1,0);
scene.add(island);

/* FISHERMAN NPC */
const fisherman=new THREE.Group();
const body=new THREE.Mesh(
 new THREE.CylinderGeometry(.4,.5,2),
 new THREE.MeshLambertMaterial({color:0x8b4513})
);
body.position.y=2;
fisherman.add(body);

const head=new THREE.Mesh(
 new THREE.SphereGeometry(.45),
 new THREE.MeshLambertMaterial({color:0xffcc99})
);
head.position.y=3.3;
fisherman.add(head);

fisherman.position.set(4,1,4);
scene.add(fisherman);

/* PLAYER */
const player=new THREE.Object3D();
scene.add(player);
player.position.set(0,3,0);
player.add(camera);

let velocityY=0,grounded=true;
let yaw=0,pitch=0;

/* INVENTORY */
let money=0;
const inventory=["Rod","","","","","","","",""];
let selected=0;
const inv=document.getElementById("inventory");

function renderInv(){
 inv.innerHTML="";
 inventory.forEach((it,i)=>{
  const d=document.createElement("div");
  d.className="slot"+(i===selected?" active":"");
  d.textContent=it;
  d.onclick=()=>{selected=i;renderInv()};
  inv.appendChild(d);
 });
}
renderInv();

/* SHOP LOGIC */
function addItem(item){
 for(let i=0;i<inventory.length;i++){
  if(inventory[i]===""){inventory[i]=item;renderInv();return true;}
 }
 return false;
}

buyRod.onclick=()=>{
 if(money>=100 && addItem("Sun Rod")){
  money-=100;moneyDiv.textContent="$"+money;
 }
};
buyBait.onclick=()=>{
 if(money>=15 && addItem("Bait")){
  money-=15;moneyDiv.textContent="$"+money;
 }
};

/* NPC CLICK */
const raycaster=new THREE.Raycaster();
const touch=new THREE.Vector2();

renderer.domElement.addEventListener("touchstart",e=>{
 touch.x=(e.touches[0].clientX/innerWidth)*2-1;
 touch.y=-(e.touches[0].clientY/innerHeight)*2+1;
 raycaster.setFromCamera(touch,camera);
 const hit=raycaster.intersectObject(fisherman,true);
 if(hit.length>0) shop.style.display="block";
});

/* LOOP */
function animate(){
 requestAnimationFrame(animate);
 renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
